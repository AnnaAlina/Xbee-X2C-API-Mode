# Xbee-X2C-API-Mode
This project further exemplifies the utilization of API mode with the Xbee X2C modules. The goal is to use serial communication between an Arduino and the XBee to digitally write a binary number to I/O pins 0 - 3 to the router XBee. Additionally, bonus objectives are to send the binary number to multiple XBees as well as send to individual XBee addresses.

API mode, also known as Application Mode, uses one Xbee module to act as the coordinator. When configured in this mode, this device can communicate with multiple peripheral Xbee devices on its personal area network. With one Xbee set as the coordinator, it can broadcast information utilizing the Arduino Mega and other Xbee router devices that are connected to its same PAN ID will be able to receive that information. Furthermore, The coordinator can configure router Xbee devices remotely by sending an API frame to either a single Xbee router or all routers within the network.

 To configure the first Xbee into API mode, the API and Coordinator settings must be enabled. The router must have Transparent Mode selected for the API settings and the coordinator option menu must have “disabled” chosen. The router should also have join verification set to enable in order to join automatically to the network when it is first powered.  The Arduino’s Serial communication baud rate is set to 9600 bps and the data configuration is set to the default 8N1. At this point the coordinator is set up to be able to change any or all of the routers on the network by broadcasting an API frame.

A frame is a series of bytes written in hexadecimal that are transmitted serially using the Arduino Mega serial monitor. They always need to be configured to be sent in a specific order: a start delimiter, the length of the frame data, the frame data itself and finally a checksum byte. The start delimiter is always 0x7E. The frame data length portion of the frame is two bytes long. Frames can vary in length depending on the data but for a remote AT command request the frame data will be 16 bytes long. Therefore the most significant bit is set to 0x00 and the least significant bit to 0x10.

The data frame itself starts with a byte identifying what kind of frame it is. In this case 0x17 is chosen as it signifies a remote AT command request. The next byte is called the frame ID byte which when set to 0x00 lets the router know that a response frame doesn’t need to be sent. The next 8 bytes are the destination address for the frame. This can either be a 64 bit unique address to send the frame to a specific router or it can be set to 0x000000000000FFFF in order to broadcast the frame to all Xbee’s on the network. After that the following two bytes are used to choose the 16-bit destination address if there are any subnetworks within the network or in this case set to 0xFFFE in order to broadcast it to all on the network. The following byte is used to configure certain remote command options, however in this case using 0x02 will simply tell the router Xbee to apply the AT command changes that come after this byte.

An AT command is a specific command to configure a wide range of parameters within the Xbee. For the purposes of this lab turning pins D0-D3 on and off are the only AT commands of interest. The AT commands for these pins are fittingly “D0”, “D1”, “D2” and “D3”. Once the two bytes needed to pick a digital pin are written the next byte is the value that the AT command should be set to. Digital pins have a number of different configuration options but for this lab 0x04 and 0x05 are used to turn the digital pin to digital low or digital high respectively. The AT command value is the final byte needed to complete the data portion of the API frame.

Lastly, a checksum byte must be written. The checksum is a byte that stores a verification number that is used to ensure that all the necessary information within the frame is correct and did not get distorted. To calculate the checksum first all bytes within the frame data are added together. This number is then truncated to the 8 least significant bits and subtracted from 255. The result is the checksum value and is written as the final byte to complete the API frame. Since the lab requires setting 4 digital pins either off or on this means that 4 frames must be sent from the coordinator to the chosen router(s).
